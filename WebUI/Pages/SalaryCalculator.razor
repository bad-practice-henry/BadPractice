@page "/salary-calculator"
@using Infrastructure.Interfaces
@using MapsterMapper
@using WebUI.Models.SalaryCalculator
@inject IStringLocalizer<Resources.Pages.SalaryCalculator> Localize;
@inject ISalaryCalculationService SalaryCalculationService;
@inject IMapper Mapper;

<PageTitle>@Localize[Resources.Pages.SalaryCalculator.SalaryCalculatorName]</PageTitle>

<div class="border rounded p-3 mb-3">
    <SalaryInputModel ValueChanged="SalaryInput_Changed"/>
</div>
<div class="border rounded p-3 mb-3">
    <SalaryResultTable Model="_resultModel"/>
</div>
<div class="border rounded p-3 mb-3">
    <SalaryYearlyCalculations Model="_yearlyModel"/>
</div>

@code {

    private SalaryCalculatorResultModel _resultModel = new();
    private SalaryCalculatorYearlyModel _yearlyModel = new();

    private void SalaryInput_Changed(SalaryCalculatorInputModel model)
    {
        var calculationResult = SalaryCalculationService.CalculateResult(model.BaseValue, model.ValueType);
        _resultModel = Mapper.Map<SalaryCalculatorResultModel>(calculationResult);

        var yearlyCalculationResult = SalaryCalculationService.CalculateYearly(model.BaseValue, model.ValueType, model.Rate);
        _yearlyModel = Mapper.Map<SalaryCalculatorYearlyModel>(yearlyCalculationResult);
    }

}