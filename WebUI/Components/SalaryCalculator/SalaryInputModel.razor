@using Infrastructure.Interfaces
@using WebUI.Models.SalaryCalculator
@using ValueType = Application.Constants.ValueType
@using Application.Constants
@using System.Globalization
@inject ISalaryCalculationService SalaryCalculationService;

<input
    class="form-control form-control-sm mb-2"
    type="number"
    @bind="_inputModel.BaseValue"
    @oninput="BaseValue_Changed"/>

<EnumSelectList TEnum="ValueType" ValueChanged="InputValueType_Changed" SelectedValue="_inputModel.ValueType"/>

<EnumCheckbox TEnum="Rate" ValueChanged="Rate_Changed" SelectedValue="_inputModel.Rate"/>


@code {

    [Parameter]
    public EventCallback<SalaryCalculatorInputModel> ValueChanged { get; set; }

    private readonly SalaryCalculatorInputModel _inputModel = new()
    {
        BaseValue = 0,
        ValueType = ValueType.Gross,
        Rate = Rate.Monthly
    };

    private async Task BaseValue_Changed(ChangeEventArgs obj)
    {
        if (obj.Value is string strValue && !string.IsNullOrEmpty(strValue))
        {
            _inputModel.BaseValue = decimal.Parse(strValue, new NumberFormatInfo {CurrencyDecimalSeparator = "."});
        }
        await OnChange();
    }

    private async Task InputValueType_Changed(ValueType valueType)
    {
        _inputModel.ValueType = valueType;
        await OnChange();
    }

    private async Task Rate_Changed(Rate rate)
    {
        _inputModel.Rate = rate;
        await OnChange();
    }

    private async Task OnChange()
    {
        await ValueChanged.InvokeAsync(_inputModel);
    }

}